---
import BaseLayout from "../layouts/BaseLayout.astro";

interface Props {
  title: string;
  description?: string;
  pubDate?: string | Date;
  updatedDate?: string | Date;
  heroImage?: string;
  heroCaption?: string;
  tags?: string[] | string;
  keywords?: string[];
  seoTitle?: string;
}

const {
  title,
  description = "",
  pubDate,
  updatedDate,
  heroImage,
  heroCaption = "",
  tags = [],
  keywords = [],
  seoTitle
} = Astro.props as Props;

// normalize dates
const dPub = pubDate ? new Date(pubDate) : null;
const dUpd = updatedDate ? new Date(updatedDate) : null;
const isoPub = dPub && !isNaN(+dPub) ? dPub.toISOString() : "";
const isoUpd = dUpd && !isNaN(+dUpd) ? dUpd.toISOString() : "";
const displayPub = dPub && !isNaN(+dPub)
  ? dPub.toLocaleDateString("en-US", { year:"numeric", month:"long", day:"numeric" })
  : "";
const displayUpd = dUpd && !isNaN(+dUpd)
  ? dUpd.toLocaleDateString("en-US", { year:"numeric", month:"long", day:"numeric" })
  : "";

// normalize tags
const tagList = Array.isArray(tags)
  ? tags
  : typeof tags === "string"
    ? tags.split(",").map(s => s.trim()).filter(Boolean)
    : [];
---

<BaseLayout pageTitle={seoTitle ?? title} description={description}>
  <!-- Page shell: keeps background visible at sides -->
  <main class="page-shell">
    <!-- White card that extends ~1" beyond the text column on each side -->
    <article class="post-card">
      <header class="post-header">
        <h1 class="post-title">{title}</h1>
        <div class="post-meta">
          {displayPub && <time datetime={isoPub} title="Published">{displayPub}</time>}
          {displayUpd && displayUpd !== displayPub && (
            <>
              <span class="sep">•</span>
              <time datetime={isoUpd} title="Updated">{displayUpd}</time>
            </>
          )}
        </div>

        {tagList.length > 0 && (
          <ul class="post-tags">
            {tagList.map(t => <li class="tag" key={t}>{t}</li>)}
          </ul>
        )}

        {heroImage && (
          <figure class="post-hero">
            <img
              src={typeof heroImage === "string" ? heroImage : heroImage.src}
              alt={title}
              loading="eager"
            />
            {heroCaption && <figcaption>{heroCaption}</figcaption>}
          </figure>
        )}
      </header>

      <!-- Inner text column (long-form reading width) -->
      <div class="post-body prose">
        <slot />  {/* MDX content renders here */}
      </div>
    </article>
  </main>

  <style>
    :root{
      /* Readable text column + ~1" side bleed on each side for the white card */
      --reading-width: 72ch;          /* ~65–75 chars/line */
      --side-bleed: min(96px, 8vw);   /* ~1 inch ≈ 96px, responsive on small screens */
      --base-font: 18px;
      --lh: 1.7;
      --ink: #111;
      --muted: #6a6a6d;
    }

    /* Centers the white card and lets the starry background peek at sides */
    .page-shell{
      max-width: 1200px;
      margin: 0 auto;
      padding: clamp(16px, 2vw, 24px);
    }

    /* White box */
    .post-card{
      max-width: calc(var(--reading-width) + (2 * var(--side-bleed)));
      margin: clamp(16px, 2vw, 24px) auto 6rem auto;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.16);
      overflow: hidden;
    }

    .post-header{
      max-width: calc(var(--reading-width) + (2 * var(--side-bleed)));
      padding: clamp(18px, 2.2vw, 28px);
      margin: 0 auto;
    }

    .post-title{ margin: 0 0 .35rem; line-height: 1.1; }
    .post-meta{
      font-size: .95rem;
      color: var(--muted);
      display: flex; gap: .5rem; align-items: center; flex-wrap: wrap;
      margin-bottom: .4rem;
    }
    .post-tags{
      list-style: none; display: flex; gap: .4rem; padding: 0; margin: .5rem 0 0;
      flex-wrap: wrap;
    }
    .post-tags .tag{
      font-size: .78rem; color: #2d3a62; background: #eef2ff; border: 1px solid #dde4ff;
      padding: .22rem .5rem; border-radius: 999px; white-space: nowrap;
    }

    .post-hero{ margin: 1rem 0 1.25rem; }
    .post-hero img{
      width: 100%; height: auto; display: block; border-radius: 10px;
    }
    .post-hero figcaption{
      font-size: .9rem; color: var(--muted); margin-top: .4rem; text-align: center;
    }

    /* Inner reading column */
    .post-body{
      max-width: var(--reading-width);
      margin: 0 auto;
      padding: 0 clamp(18px, 2.2vw, 28px) clamp(22px, 2.4vw, 34px);
      font-size: clamp(17px, 0.35vw + 16px, var(--base-font));
      line-height: var(--lh);
      color: var(--ink);
    }

    /* Typography rhythm (denser, long-form feel) */
    .post-body p{ m
