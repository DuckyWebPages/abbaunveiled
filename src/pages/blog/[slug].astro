---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, getEntry } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("blog", ({ data }) => !data?.draft);

  // Guard against bad/empty slugs
  const paths = entries
    .filter((e) => typeof e.slug === "string" && e.slug.length > 0)
    .map((e) => ({
      params: { slug: e.slug },
      props: { entryId: e.id }, // pass a stable reference, not the whole object
    }));

  return paths;
}

const { entryId } = Astro.props;

// Re-fetch by id inside the page for a clean, predictable object
const post = await getEntry(entryId);
const { Content, data } = await post.render();

const title = data.title ?? "Post";
const description = data.seo ?? data.description ?? "";
const heroImage = data.heroImage ?? null;
---

<BaseLayout {title} description={description} seo={description} heroImage={heroImage}>
  <article>
    <h1>{title}</h1>
    {heroImage && (
      <img src={heroImage} alt={title} style="width:100%;height:auto;margin:1rem 0;border-radius:12px;" />
    )}
    <Content />
  </article>
</BaseLayout>
