---
import { getCollection, getEntry } from "astro:content";
import PostLayout from "../../layouts/PostLayout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => !data.draft);
  return posts.map((p) => ({ params: { slug: p.slug } }));
}

const slug = String(Astro.params.slug ?? "");
const post = slug ? await getEntry("blog", slug) : null;
if (!post) return Astro.redirect("/blog");

const { Content } = await post.render();
const d = post.data ?? {};
const hero = d.heroImage?.src ?? d.heroImage ?? undefined;

const props = {
  title: d.title ?? slug,
  description: d.description ?? d.excerpt ?? "",
  pubDate: d.pubDate,
  updatedDate: d.updatedDate,
  heroImage: hero,
  heroCaption: d.heroCaption ?? "",
  tags: d.tags ?? [],
  keywords: Array.isArray(d.seo) ? d.seo : [],
  seoTitle: d.seoTitle ?? undefined,
};
---

<PostLayout {...props}>
  <Content />
</PostLayout>
