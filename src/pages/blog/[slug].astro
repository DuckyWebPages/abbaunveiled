---
import { getCollection, getEntry } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => !data.draft);
  return posts.map((p) => ({ params: { slug: p.slug } }));
}

const slug = String(Astro.params.slug ?? "");
const post = slug ? await getEntry("blog", slug) : null;
if (!post) return Astro.redirect("/blog");

const { Content } = await post.render();
const data = post.data ?? {};
const { title = slug, description = "", pubDate } = data;

// keywords from tags (optional)
const keywords = Array.isArray(data.tags)
  ? data.tags
  : typeof data.tags === "string"
    ? data.tags.split(",").map((s) => s.trim()).filter(Boolean)
    : [];

const d = pubDate ? new Date(pubDate) : null;
const isoDate = d && !isNaN(+d) ? d.toISOString() : "";
const displayDate =
  d && !isNaN(+d)
    ? d.toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })
    : "";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
    {description && <meta name="description" content={description} />}
    {keywords.length > 0 && <meta name="keywords" content={keywords.join(", ")} />}
    {isoDate && <meta property="article:published_time" content={isoDate} />}
  </head>
  <body>
    <div class="post-page">

      <!-- Decorative star background with overlay -->
      <section class="post-hero-bg" role="img" aria-label="Starry background">
        <div class="post-hero-inner">
          <!-- Big white script title above the white box -->
          <h1 class="post-banner-title">Abba Unveiled Blog</h1>
        </div>
      </section>

      <!-- White content card -->
      <main class="post-main">
        <article class="post-card post-content prose">
          <header class="post-header">
            <h1 class="post-title">{title}</h1>
            {displayDate && <time class="post-date" datetime={isoDate}>{displayDate}</time>}
          </header>

          <!-- Everything below is forced to the nice sans-serif -->
          <div class="post-body">
            <Content />
          </div>
        </article>
      </main>
    </div>

    <style>
      :root{
        /* Nice, modern sans stack (uses system/Inter/Roboto/etc if available) */
        --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, Inter, "Helvetica Neue",
                     Arial, "Noto Sans", "Liberation Sans", sans-serif;
      }

      /* === Starry header area === */
      .post-hero-bg {
        position: relative;
        background: url("/images/stars-northern.png") center / cover no-repeat fixed;
        min-height: clamp(240px, 30vw, 460px);
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
      }

      /* Keep the hero script look */
      .post-banner-title {
        margin: 0;
        color: #fff !important;
        font-family: "Finest Romance Script", cursive;
        font-weight: 400;
        line-height: .9;
        text-shadow: 0 2px 20px rgba(0,0,0,.55);
        font-size: clamp(3.5rem, 9vw, 7.5rem);
      }

      /* darken for contrast */
      .post-hero-bg::after {
        content: "";
        position: absolute; inset: 0;
        background: linear-gradient(to bottom, rgba(0,0,0,.35), rgba(0,0,0,.55));
      }
      .post-hero-inner {
        position: relative; /* above overlay */
        padding: clamp(24px, 5vw, 48px) clamp(16px, 4vw, 32px);
        text-align: center;
      }

      /* === White content card over neutral page bg === */
      .post-main {
        background: linear-gradient(180deg, rgba(247,247,249,1) 0%, rgba(255,255,255,1) 100%);
        padding: clamp(16px, 4vw, 32px);
      }
      .post-card {
        max-width: 72ch;
        margin: -3rem auto 3rem; /* pull card up toward header */
        background: #fff;
        color: inherit;
        border: 1px solid #ececf4;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0,0,0,.06);
        padding: clamp(16px, 4vw, 32px);
      }

      /* Title & meta inside the card */
      .post-header { margin-bottom: .75rem; }
      .post-title {
        margin: 0 0 .25rem;
        line-height: 1.15;
        font-family: var(--font-sans);
        font-weight: 800;
        letter-spacing: -.01em;
      }
      .post-date { display: block; color: #6a6a6d; font-size: .95rem; }

      /* ✅ Force the entire article body to the sans stack */
      .post-body{
        font-family: var(--font-sans);
        font-size: 1.05rem;
        line-height: 1.65;
        color: #0b0b0c;
      }
      .post-body :is(h1,h2,h3,h4,h5,h6){
        font-family: var(--font-sans);
        font-weight: 800;
        letter-spacing: -.005em;
        line-height: 1.2;
        margin: 1.6rem 0 .7rem;
        color: #0b0b0c;
      }
      .post-body p{ margin: .9rem 0; }
      .post-body ul, .post-body ol{ padding-left: 1.2rem; margin: .9rem 0; }
      .post-body li{ margin: .35rem 0; }
      .post-body blockquote{
        margin: 1.2rem 0; padding: .9rem 1rem;
        background: #f7f7f9; border-left: 4px solid #e2e2ee; color: #333; border-radius: 6px;
      }

      /* Keep code/monospace readable */
      .post-body :is(code, pre){
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Cascadia Mono", "Segoe UI Mono",
                     "Roboto Mono", "Oxygen Mono", "Ubuntu Monospace", "Source Code Pro",
                     "Fira Mono", "Droid Sans Mono", "Courier New", monospace;
        font-size: .95em;
      }

      /* Images */
      .post-card img { border-radius: 10px; }

      @media (max-width: 720px) {
        .post-card { margin: -2rem auto 2rem; }
      }
    </style>
  </body>
</html>
